<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fast Food Nutrition Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.12.1/plotly.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="nutrition.html">Nutrition Values</a>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Data Analysis
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="../Jake/top10_revenue.html">Revenue Sales</a></li>
                            <li><a class="dropdown-item" href="../Jake/revenue_dist.html">Revenue Distribution</a></li>
                            <li><a class="dropdown-item" href="../Jake/franch_vs_comp.html">Franchise vs Company Stores</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="../MostPopularFF/index.html">Most Popular</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../Sylvester/index.html">Top 10</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
<div class="container">
    <h1 class="text-center mt-5">Fast Food Nutrition Dashboard</h1>

    <!-- Infographic Section: Highest and Lowest Calories, Sodium, and Fat Items -->
    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Highest Calories Item</div>
                <div class="card-body">
                    <h5 id="highest-calories-item" class="card-title"></h5>
                    <p id="highest-calories-value" class="card-text"></p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Highest Sodium Item</div>
                <div class="card-body">
                    <h5 id="highest-sodium-item" class="card-title"></h5>
                    <p id="highest-sodium-value" class="card-text"></p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">Restaurant with Highest Average Calories</div>
                <div class="card-body">
                    <h5 id="highest-average-calories-restaurant" class="card-title"></h5>
                    <p id="highest-average-calories-value" class="card-text"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Dropdown to select food item -->
    <div class="mt-4 text-center">
        <select id="food-dropdown" class="form-select" style="width: 50%; margin: auto;">
            <!-- Options will be added here dynamically using JavaScript -->
        </select>
    </div>

    <!-- Graph -->
    <div id="nutrition-graph" class="mt-4"></div>

    <!-- Table -->
    <div id="nutrition-table" class="mt-4">
        <!-- Table will be populated dynamically using JavaScript -->
    </div>
    <div class="text-center mt-5">
        <a href="../index.html" class="btn btn-primary">Back to Home</a>
</div>

<script>
// Load CSV data and populate the dashboard
const filePath = "cleaned_data.csv";  

let data = [];  

// Load CSV data
fetch(filePath)
    .then(response => response.text())
    .then(csvData => {
        const rows = csvData.split('\n');
        const headers = rows[0].split(',');

        // Process CSV data
        data = rows.slice(1).map(row => {
            const rowData = row.split(',');
            const itemData = {};
            headers.forEach((header, index) => {
                itemData[header] = rowData[index];
            });
            return itemData;
        });

        populateDropdown();
        updateDashboard();
    })
    .catch(error => console.error("Error loading CSV data:", error));

// Populate dropdown with food items
function populateDropdown() {
    const dropdown = document.getElementById('food-dropdown');
    data.forEach(item => {
        const option = document.createElement('option');
        option.value = item['item'];
        option.textContent = `${item['item']} - ${item['restaurant']}`;
        dropdown.appendChild(option);
    });
}

// Update the dashboard based on selected food item
function updateDashboard() {
    const selectedFood = document.getElementById('food-dropdown').value;
    const selectedData = data.find(item => item['item'] === selectedFood);

    // Get the highest and lowest calories, sodium items
    const highestCalories = data.reduce((max, current) => current['calories'] > max['calories'] ? current : max, data[0]);
    const highestSodium = data.reduce((max, current) => current['sodium'] > max['sodium'] ? current : max, data[0]);

    // Get the restaurant with the highest and lowest average calories
    const avgCaloriesPerRestaurant = {};
    data.forEach(item => {
        if (!avgCaloriesPerRestaurant[item['restaurant']]) {
            avgCaloriesPerRestaurant[item['restaurant']] = [];
        }
        avgCaloriesPerRestaurant[item['restaurant']].push(Number(item['calories']));
    });

    const restaurantAvgCalories = Object.keys(avgCaloriesPerRestaurant).map(restaurant => {
        const avg = avgCaloriesPerRestaurant[restaurant].reduce((a, b) => a + b) / avgCaloriesPerRestaurant[restaurant].length;
        return { restaurant, avg };
    });

    const highestAvgCaloriesRestaurant = restaurantAvgCalories.reduce((max, current) => current.avg > max.avg ? current : max, restaurantAvgCalories[0]);

    // Populate infographic section
    document.getElementById('highest-calories-item').textContent = highestCalories['item'];
    document.getElementById('highest-calories-value').textContent = `${highestCalories['calories']} kcal`;

    document.getElementById('highest-sodium-item').textContent = highestSodium['item'];
    document.getElementById('highest-sodium-value').textContent = `${highestSodium['sodium']} mg`;

    document.getElementById('highest-average-calories-restaurant').textContent = highestAvgCaloriesRestaurant.restaurant;
    document.getElementById('highest-average-calories-value').textContent = `${highestAvgCaloriesRestaurant.avg.toFixed(2)} kcal`;

    // Create graph using Plotly.js
    const nutritionData = Object.keys(selectedData).filter(key => key !== 'item' && key !== 'restaurant');
    const nutritionValues = nutritionData.map(key => selectedData[key]);

    const trace = {
        x: nutritionData,
        y: nutritionValues,
        type: 'bar',
        marker: { color: 'rgb(200, 100, 100)' }
    };

    const layout = {
        title: `Nutritional Values of ${selectedFood}`,
        xaxis: { title: 'Nutrient' },
        yaxis: { title: 'Amount' }
    };

    Plotly.newPlot('nutrition-graph', [trace], layout);

    // Create table
    let tableHTML = '<table class="table table-bordered"><thead><tr><th>Nutrient</th><th>Value</th></tr></thead><tbody>';
    nutritionData.forEach((nutrient, index) => {
        tableHTML += `<tr><td>${nutrient}</td><td>${nutritionValues[index]}</td></tr>`;
    });
    tableHTML += '</tbody></table>';
    document.getElementById('nutrition-table').innerHTML = tableHTML;
}

// Event listener for dropdown change
document.getElementById('food-dropdown').addEventListener('change', updateDashboard);

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>